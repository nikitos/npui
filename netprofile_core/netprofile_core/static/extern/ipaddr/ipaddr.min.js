(function(){var t,r,e,n,i,o,s,a;r={},a=this,"undefined"!=typeof module&&null!==module&&module.exports?module.exports=r:a.ipaddr=r,s=function(t,r,e,n){var i,o;if(t.length!==r.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");for(i=0;n>0;){if(o=e-n,0>o&&(o=0),t[i]>>o!==r[i]>>o)return!1;n-=e,i+=1}return!0},r.subnetMatch=function(t,r,e){var n,i,o,s,a;null==e&&(e="unicast");for(n in r)for(i=r[n],"[object Array]"!==toString.call(i[0])&&(i=[i]),s=0,a=i.length;a>s;s++)if(o=i[s],t.match.apply(t,o))return n;return e},r.IPv4=function(){function t(t){var r,e,n;if(4!==t.length)throw new Error("ipaddr: ipv4 octet count should be 4");for(e=0,n=t.length;n>e;e++)if(r=t[e],!(r>=0&&255>=r))throw new Error("ipaddr: ipv4 octet is a byte");this.octets=t}return t.prototype.kind=function(){return"ipv4"},t.prototype.getValue=function(){return this.toInteger()},t.prototype.toString=function(){return this.octets.join(".")},t.prototype.toByteArray=function(){return this.octets.slice(0)},t.prototype.toInteger=function(){return(this.octets[0]<<24|this.octets[1]<<16|this.octets[2]<<8|this.octets[3])>>>0},t.prototype.match=function(t,r){if("ipv4"!==t.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return s(this.octets,t.octets,8,r)},t.SpecialRanges={unspecified:[[new t([0,0,0,0]),8]],broadcast:[[new t([255,255,255,255]),32]],multicast:[[new t([224,0,0,0]),4]],linkLocal:[[new t([169,254,0,0]),16]],loopback:[[new t([127,0,0,0]),8]],"private":[[new t([10,0,0,0]),8],[new t([172,16,0,0]),12],[new t([192,168,0,0]),16]],reserved:[[new t([192,0,0,0]),24],[new t([192,0,2,0]),24],[new t([192,88,99,0]),24],[new t([198,51,100,0]),24],[new t([203,0,113,0]),24],[new t([240,0,0,0]),4]]},t.prototype.range=function(){return r.subnetMatch(this,t.SpecialRanges)},t.prototype.toIPv4MappedAddress=function(){return r.IPv6.parse("::ffff:"+this.toString())},t}(),e="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp("^"+e+"\\."+e+"\\."+e+"\\."+e+"$","i"),longValue:new RegExp("^"+e+"$","i")},r.IPv4.parser=function(t){var r,e,i,o,s;if(e=function(t){return"0"===t[0]&&"x"!==t[1]?parseInt(t,8):parseInt(t)},"object"==typeof t&&t.octets)return t.octets;if("number"==typeof t&&(t=t.toString()),r=t.match(n.fourOctet))return function(){var t,n,o,s;for(o=r.slice(1,6),s=[],t=0,n=o.length;n>t;t++)i=o[t],s.push(e(i));return s}();if(r=t.match(n.longValue)){if(s=e(r[1]),s>4294967295||0>s)throw new Error("ipaddr: address outside defined range");return function(){var t,r;for(r=[],o=t=0;24>=t;o=t+=8)r.push(s>>o&255);return r}().reverse()}return null},r.IPv6=function(){function t(t){var r,e,n;if(8!==t.length)throw new Error("ipaddr: ipv6 part count should be 8");for(e=0,n=t.length;n>e;e++)if(r=t[e],!(r>=0&&65535>=r))throw new Error("ipaddr: ipv6 part should fit to two octets");this.parts=t}return t.prototype.kind=function(){return"ipv6"},t.prototype.getValue=function(){return this.toByteArray()},t.prototype.toString=function(){var t,r,e,n,i,o,s;for(i=function(){var t,e,n,i;for(n=this.parts,i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(r.toString(16));return i}.call(this),t=[],e=function(r){return t.push(r)},n=0,o=0,s=i.length;s>o;o++)switch(r=i[o],n){case 0:e("0"===r?"":r),n=1;break;case 1:"0"===r?n=2:e(r);break;case 2:"0"!==r&&(e(""),e(r),n=3);break;case 3:e(r)}return 2===n&&(e(""),e("")),t.join(":")},t.prototype.toByteArray=function(){var t,r,e,n,i;for(t=[],i=this.parts,e=0,n=i.length;n>e;e++)r=i[e],t.push(r>>8),t.push(255&r);return t},t.prototype.toNormalizedString=function(){var t;return function(){var r,e,n,i;for(n=this.parts,i=[],r=0,e=n.length;e>r;r++)t=n[r],i.push(t.toString(16));return i}.call(this).join(":")},t.prototype.match=function(t,r){if("ipv6"!==t.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return s(this.parts,t.parts,16,r)},t.SpecialRanges={unspecified:[new t([0,0,0,0,0,0,0,0]),128],linkLocal:[new t([65152,0,0,0,0,0,0,0]),10],multicast:[new t([65280,0,0,0,0,0,0,0]),8],loopback:[new t([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new t([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new t([0,0,0,0,0,65535,0,0]),96],rfc6145:[new t([0,0,0,0,65535,0,0,0]),96],rfc6052:[new t([100,65435,0,0,0,0,0,0]),96],"6to4":[new t([8194,0,0,0,0,0,0,0]),16],teredo:[new t([8193,0,0,0,0,0,0,0]),32],reserved:[[new t([8193,3512,0,0,0,0,0,0]),32]]},t.prototype.range=function(){return r.subnetMatch(this,t.SpecialRanges)},t.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},t.prototype.toIPv4Address=function(){var t,e,n;if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");return n=this.parts.slice(-2),t=n[0],e=n[1],new r.IPv4([t>>8,255&t,e>>8,255&e])},t}(),i="(?:[0-9a-f]+::?)+",o={"native":new RegExp("^(::)?("+i+")?([0-9a-f]+)?(::)?$","i"),transitional:new RegExp("^((?:"+i+")|(?:::)(?:"+i+")?)"+(""+e+"\\."+e+"\\."+e+"\\."+e+"$"),"i")},t=function(t,r){var e,n,i,o,s;if(t.indexOf("::")!==t.lastIndexOf("::"))return null;for(e=0,n=-1;(n=t.indexOf(":",n+1))>=0;)e++;for(":"===t[0]&&e--,":"===t[t.length-1]&&e--,s=r-e,o=":";s--;)o+="0:";return t=t.replace("::",o),":"===t[0]&&(t=t.slice(1)),":"===t[t.length-1]&&(t=t.slice(0,-1)),function(){var r,e,n,o;for(n=t.split(":"),o=[],r=0,e=n.length;e>r;r++)i=n[r],o.push(parseInt(i,16));return o}()},r.IPv6.parser=function(r){var e,n;return"object"==typeof r&&r.parts?r.parts:r.match(o["native"])?t(r,8):(e=r.match(o.transitional))&&(n=t(e[1].slice(0,-1),6))?(n.push(parseInt(e[2])<<8|parseInt(e[3])),n.push(parseInt(e[4])<<8|parseInt(e[5])),n):null},r.IPv4.isIPv4=r.IPv6.isIPv6=function(t){return null!==this.parser(t)},r.IPv4.isValid=r.IPv6.isValid=function(t){var r;try{return new this(this.parser(t)),!0}catch(e){return r=e,!1}},r.IPv4.parse=r.IPv6.parse=function(t){var r;if(r=this.parser(t),null===r)throw new Error("ipaddr: string is not formatted like ip address");return new this(r)},r.isValid=function(t){return r.IPv6.isValid(t)||r.IPv4.isValid(t)},r.parse=function(t){if(r.IPv6.isValid(t))return r.IPv6.parse(t);if(r.IPv4.isValid(t))return r.IPv4.parse(t);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},r.process=function(t){var r;return r=this.parse(t),"ipv6"===r.kind()&&r.isIPv4MappedAddress()?r.toIPv4Address():r}}).call(this);
